/**
 * –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AR Door Viewer
 */

const CONFIG = {
    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–µ—Ä—ã
    // ============================================
    CAMERA: {
        // –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–∞—è –∑–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞
        facingMode: 'environment',
        // –ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
        width: { ideal: 1280 },
        height: { ideal: 720 },
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
        minWidth: 640,
        minHeight: 480
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ML –¥–µ—Ç–µ–∫—Ü–∏–∏
    // ============================================
    ML_DETECTION: {
        // –ß–∞—Å—Ç–æ—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞ (–∫–∞–∂–¥—ã–π N-–π –∫–∞–¥—Ä)
        frameInterval: 5,
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏
        minConfidence: 0.6,
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω –ø—Ä–æ–µ–º–∞ (–≤—ã—Å–æ—Ç–∞/—à–∏—Ä–∏–Ω–∞)
        minAspectRatio: 1.5,
        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω –ø—Ä–æ–µ–º–∞
        maxAspectRatio: 3.0,
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–µ–º–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
        minSize: 100,
        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–µ–º–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
        maxSize: 2000,
        // –ö–ª–∞—Å—Å—ã –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏
        targetClasses: ['door', 'window', 'person'],
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å edge detection –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è
        useEdgeDetection: true
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Three.js —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
    // ============================================
    RENDERER: {
        // –ú–∞—Å—à—Ç–∞–± –ø–∏–∫—Å–µ–ª–µ–π (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
        pixelRatio: Math.min(window.devicePixelRatio, 2),
        // –í–∫–ª—é—á–∏—Ç—å –∞–Ω—Ç–∏–∞–ª–∏–∞—Å–∏–Ω–≥
        antialias: true,
        // –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
        alpha: true,
        // –í–∫–ª—é—á–∏—Ç—å —Ç–µ–Ω–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
        shadows: false,
        // –ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ–Ω–µ–π
        shadowMapSize: 1024,
        // –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        debug: false
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–µ—Ä—ã Three.js
    // ============================================
    THREE_CAMERA: {
        // –£–≥–æ–ª –æ–±–∑–æ—Ä–∞ (FOV)
        fov: 75,
        // –ë–ª–∏–∂–Ω—è—è –ø–ª–æ—Å–∫–æ—Å—Ç—å –æ—Ç—Å–µ—á–µ–Ω–∏—è
        near: 0.1,
        // –î–∞–ª—å–Ω—è—è –ø–ª–æ—Å–∫–æ—Å—Ç—å –æ—Ç—Å–µ—á–µ–Ω–∏—è
        far: 1000,
        // –ü–æ–∑–∏—Ü–∏—è –∫–∞–º–µ—Ä—ã
        position: { x: 0, y: 0, z: 5 }
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Å–≤–µ—â–µ–Ω–∏—è
    // ============================================
    LIGHTING: {
        // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –æ–∫—Ä—É–∂–∞—é—â–µ–≥–æ —Å–≤–µ—Ç–∞
        ambientIntensity: 1.0,
        // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞
        directionalIntensity: 0.8,
        // –¶–≤–µ—Ç –æ–∫—Ä—É–∂–∞—é—â–µ–≥–æ —Å–≤–µ—Ç–∞
        ambientColor: 0xffffff,
        // –¶–≤–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞
        directionalColor: 0xffffff,
        // –ü–æ–∑–∏—Ü–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞
        directionalPosition: { x: 5, y: 10, z: 7 }
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è
    // ============================================
    SMOOTHING: {
        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ (0-1)
        positionAlpha: 0.3,
        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∞
        scaleAlpha: 0.2,
        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è —Ä–æ—Ç–∞—Ü–∏–∏
        rotationAlpha: 0.25
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    // ============================================
    PERFORMANCE: {
        // –¶–µ–ª–µ–≤–æ–π FPS
        targetFPS: 30,
        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π FPS
        maxFPS: 60,
        // –í–∫–ª—é—á–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
        adaptiveQuality: true,
        // –ü–æ—Ä–æ–≥–∏ –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        fpsThresholds: {
            high: 50,
            medium: 30,
            low: 15
        },
        // –ù–∞—á–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (0.5 - 1.0)
        initialQuality: 1.0,
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
        minQuality: 0.5,
        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
        maxQuality: 1.0
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ 3D-–º–æ–¥–µ–ª–µ–π
    // ============================================
    MODELS: {
        // –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
        available: [
            {
                id: 'door_classic',
                name: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –¥–≤–µ—Ä—å',
                description: '–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è –¥–≤–µ—Ä—å —Å –ø–∞–Ω–µ–ª—è–º–∏',
                scale: 1.0,
                icon: 'üö™'
            },
            {
                id: 'door_modern',
                name: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–≤–µ—Ä—å',
                description: '–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –¥–≤–µ—Ä—å —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ –ª–∏–Ω–∏—è–º–∏',
                scale: 1.0,
                icon: 'üö™'
            },
            {
                id: 'door_glass',
                name: '–°—Ç–µ–∫–ª—è–Ω–Ω–∞—è –¥–≤–µ—Ä—å',
                description: '–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Å—Ç–µ–∫–ª—è–Ω–Ω–∞—è –¥–≤–µ—Ä—å —Å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–æ–π —Ä–∞–º–æ–π',
                scale: 1.0,
                icon: 'üö™'
            }
        ],
        // –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        default: 'door_classic',
        // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
        cacheModels: true,
        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
        maxCachedModels: 5
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ UI
    // ============================================
    UI: {
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ—Ç–ª–∞–¥–∫–∏
        showDebugInfo: false,
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
        showHints: true,
        // –í—Ä–µ–º—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ (–º—Å)
        hintDuration: 3000,
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞
        showStatusIndicator: true,
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å
        showInfoPanel: false
    },

    // ============================================
    // –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
    // ============================================
    ERRORS: {
        CAMERA_DENIED: '–ù–µ–æ–±—Ö–æ–¥–∏–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã AR. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.',
        CAMERA_NOT_FOUND: '–ö–∞–º–µ—Ä–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.',
        WEBGL_NOT_SUPPORTED: '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebGL. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä.',
        MODEL_LOAD_FAILED: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ 3D-–º–æ–¥–µ–ª–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.',
        ML_INIT_FAILED: '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.',
        LOW_PERFORMANCE: '–ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ.',
        UNKNOWN_ERROR: '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.'
    },

    // ============================================
    // –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    // ============================================
    MESSAGES: {
        INITIALIZING: '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...',
        LOADING_ML_MODEL: '–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è...',
        LOADING_3D_MODEL: '–ó–∞–≥—Ä—É–∑–∫–∞ 3D-–º–æ–¥–µ–ª–∏...',
        SEARCHING_DOORWAY: '–ò—â–µ–º –¥–≤–µ—Ä–Ω–æ–π –ø—Ä–æ–µ–º...',
        DOORWAY_FOUND: '–ü—Ä–æ–µ–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω!',
        HINT_MOVE_CAMERA: '–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –¥–≤–µ—Ä–Ω–æ–π –ø—Ä–æ–µ–º',
        HINT_ADJUST_POSITION: '–û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã',
        READY: '–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ'
    },

    // ============================================
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–ª–∞–¥–∫–∏
    // ============================================
    DEBUG: {
        // –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
        logging: true,
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å FPS —Å—á–µ—Ç—á–∏–∫
        showFPS: true,
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–µ–∫—Ü–∏–∏
        showDetectionBounds: false,
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        showPerformanceMetrics: false
    },

    // ============================================
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    // ============================================

    /**
     * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
     */
    getDevicePerformanceLevel() {
        const cores = navigator.hardwareConcurrency || 4;
        const memory = navigator.deviceMemory || 4;

        if (cores >= 8 && memory >= 6) return 'high';
        if (cores >= 4 && memory >= 4) return 'medium';
        return 'low';
    },

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
     */
    getQualitySettings(level) {
        const settings = {
            high: {
                renderScale: 1.0,
                mlInterval: 3,
                shadows: true,
                antialias: true,
                pixelRatio: 2
            },
            medium: {
                renderScale: 0.75,
                mlInterval: 5,
                shadows: false,
                antialias: true,
                pixelRatio: 1
            },
            low: {
                renderScale: 0.5,
                mlInterval: 7,
                shadows: false,
                antialias: false,
                pixelRatio: 1
            }
        };

        return settings[level] || settings.medium;
    },

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –ø–æ ID
     */
    getModelById(id) {
        return this.MODELS.available.find(m => m.id === id);
    },

    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –±—Ä–∞—É–∑–µ—Ä–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö API
     */
    checkBrowserSupport() {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ WebGL (–ø—Ä–æ–±—É–µ–º webgl2, –∑–∞—Ç–µ–º webgl)
        const canvas = document.createElement('canvas');
        let webglSupported = false;
        try {
            webglSupported = !!(canvas.getContext('webgl2') || canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
        } catch (e) {
            webglSupported = false;
        }

        const support = {
            webgl: webglSupported,
            webrtc: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
            webworker: typeof Worker !== 'undefined'
        };

        return {
            supported: support.webgl && support.webrtc,
            details: support
        };
    },

    /**
     * –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
     */
    log(...args) {
        if (this.DEBUG.logging) {
            console.log('[AR Door Viewer]', ...args);
        }
    },

    /**
     * –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
     */
    error(...args) {
        console.error('[AR Door Viewer ERROR]', ...args);
    },

    /**
     * –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
     */
    warn(...args) {
        console.warn('[AR Door Viewer WARNING]', ...args);
    }
};

// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
if (typeof module !== 'undefined' && module.exports) {
    module.exports = CONFIG;
}

#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç—ã –¥–ª—è –∏–≥—Ä—ã "–ú–æ—Ä—Å–∫–æ–π –±–æ–π"
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ –±–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞
"""

import sys
from battleship import Ship, Board, Game


def test_ship():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–ª–∞—Å—Å Ship"""
    print("=" * 50)
    print("–¢–ï–°–¢ 1: –ö–ª–∞—Å—Å Ship")
    print("=" * 50)
    
    # –°–æ–∑–¥–∞–µ–º –∫–æ—Ä–∞–±–ª—å —Ä–∞–∑–º–µ—Ä–æ–º 3
    ship = Ship(3)
    ship.place(0, 0, horizontal=True)
    
    print(f"‚úì –ö–æ—Ä–∞–±–ª—å —Å–æ–∑–¥–∞–Ω, —Ä–∞–∑–º–µ—Ä: {ship.size}")
    print(f"‚úì –ü–æ–∑–∏—Ü–∏–∏ –∫–æ—Ä–∞–±–ª—è: {ship.positions}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ
    assert ship.hit(0, 0) == True, "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏–µ"
    assert ship.hit(1, 0) == True, "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏–µ"
    assert ship.hit(5, 5) == False, "–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏—è"
    
    print(f"‚úì –ü–æ–ø–∞–¥–∞–Ω–∏—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã: {ship.hits}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ—Ç–æ–ø–ª–µ–Ω –ª–∏ –∫–æ—Ä–∞–±–ª—å
    assert ship.is_sunk() == False, "–ö–æ—Ä–∞–±–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Ç–æ–ø–ª–µ–Ω"
    print("‚úì –ö–æ—Ä–∞–±–ª—å –Ω–µ –ø–æ—Ç–æ–ø–ª–µ–Ω (2 –∏–∑ 3 –ø–æ–ø–∞–¥–∞–Ω–∏–π)")
    
    # –î–æ–±–∏–≤–∞–µ–º –∫–æ—Ä–∞–±–ª—å
    ship.hit(2, 0)
    assert ship.is_sunk() == True, "–ö–æ—Ä–∞–±–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Ç–æ–ø–ª–µ–Ω"
    print("‚úì –ö–æ—Ä–∞–±–ª—å –ø–æ—Ç–æ–ø–ª–µ–Ω (3 –∏–∑ 3 –ø–æ–ø–∞–¥–∞–Ω–∏–π)")
    
    print("\n‚úÖ –¢–µ—Å—Ç Ship –ø—Ä–æ–π–¥–µ–Ω!\n")


def test_board():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–ª–∞—Å—Å Board"""
    print("=" * 50)
    print("–¢–ï–°–¢ 2: –ö–ª–∞—Å—Å Board")
    print("=" * 50)
    
    board = Board()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    assert len(board.ships) == 6, "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å 6 –∫–æ—Ä–∞–±–ª–µ–π"
    print(f"‚úì –°–æ–∑–¥–∞–Ω–æ {len(board.ships)} –∫–æ—Ä–∞–±–ª–µ–π")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–æ—Ä–∞–±–ª–µ–π
    sizes = [ship.size for ship in board.ships]
    assert sizes == [3, 2, 2, 1, 1, 1], f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–æ—Ä–∞–±–ª–µ–π: {sizes}"
    print(f"‚úì –†–∞–∑–º–µ—Ä—ã –∫–æ—Ä–∞–±–ª–µ–π: {sizes}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
    can_place = board.can_place_ship(3, 0, 0, horizontal=True)
    assert can_place == True, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å"
    print("‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    # –†–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª—å
    placed = board.place_ship(0, 0, 0, horizontal=True)
    assert placed == True, "–ö–æ—Ä–∞–±–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω"
    print("‚úì –ö–æ—Ä–∞–±–ª—å —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ (0,0) –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ–ª—å–∑—è —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å –≤ —Ç–æ–π –∂–µ –ø–æ–∑–∏—Ü–∏–∏
    can_place = board.can_place_ship(2, 0, 0, horizontal=True)
    assert can_place == False, "–ù–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å –≤ —Ç–æ–π –∂–µ –ø–æ–∑–∏—Ü–∏–∏"
    print("‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±—É—Ñ–µ—Ä–Ω—É—é –∑–æ–Ω—É
    can_place = board.can_place_ship(2, 0, 1, horizontal=True)
    assert can_place == False, "–ù–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å —Ä—è–¥–æ–º"
    print("‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—É—Ñ–µ—Ä–Ω–æ–π –∑–æ–Ω—ã —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    print("\n‚úÖ –¢–µ—Å—Ç Board –ø—Ä–æ–π–¥–µ–Ω!\n")


def test_board_auto_placement():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫—É –∫–æ—Ä–∞–±–ª–µ–π"""
    print("=" * 50)
    print("–¢–ï–°–¢ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ—Ä–∞–±–ª–µ–π")
    print("=" * 50)
    
    board = Board()
    board.auto_place_ships()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã
    for i, ship in enumerate(board.ships):
        assert len(ship.positions) > 0, f"–ö–æ—Ä–∞–±–ª—å {i} –Ω–µ —Ä–∞–∑–º–µ—â–µ–Ω"
    
    print("‚úì –í—Å–µ –∫–æ—Ä–∞–±–ª–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ—Ä–∞–±–ª–∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è
    all_positions = set()
    for ship in board.ships:
        for pos in ship.positions:
            assert pos not in all_positions, f"–ü–æ–∑–∏—Ü–∏—è {pos} –∑–∞–Ω—è—Ç–∞ –¥–≤–∞–∂–¥—ã"
            all_positions.add(pos)
    
    print(f"‚úì –ö–æ—Ä–∞–±–ª–∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è (–≤—Å–µ–≥–æ {len(all_positions)} –∫–ª–µ—Ç–æ–∫)")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ—Ä–∞–±–ª–∏ –Ω–µ –∫–∞—Å–∞—é—Ç—Å—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞
    for ship1 in board.ships:
        for ship2 in board.ships:
            if ship1 is ship2:
                continue
            for x1, y1 in ship1.positions:
                for x2, y2 in ship2.positions:
                    dist = abs(x1 - x2) + abs(y1 - y2)
                    assert dist > 1 or (abs(x1 - x2) == 1 and abs(y1 - y2) == 1), \
                        f"–ö–æ—Ä–∞–±–ª–∏ –∫–∞—Å–∞—é—Ç—Å—è: {(x1, y1)} –∏ {(x2, y2)}"
    
    print("‚úì –ö–æ—Ä–∞–±–ª–∏ –Ω–µ –∫–∞—Å–∞—é—Ç—Å—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞")
    
    print("\n‚úÖ –¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–π–¥–µ–Ω!\n")


def test_shooting():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –≤—ã—Å—Ç—Ä–µ–ª–æ–≤"""
    print("=" * 50)
    print("–¢–ï–°–¢ 4: –õ–æ–≥–∏–∫–∞ –≤—ã—Å—Ç—Ä–µ–ª–æ–≤")
    print("=" * 50)
    
    board = Board()
    
    # –†–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª—å –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    board.ships[0].place(0, 0, horizontal=True)  # –ö–æ—Ä–∞–±–ª—å 3x1 –≤ –ø–æ–∑–∏—Ü–∏–∏ (0,0)-(2,0)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–º–∞—Ö
    hit, message = board.shoot(5, 5)
    assert hit == True and message == "–ü—Ä–æ–º–∞—Ö!", f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {message}"
    print(f"‚úì –ü—Ä–æ–º–∞—Ö: {message}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ
    hit, message = board.shoot(0, 0)
    assert hit == True and message == "–ü–æ–ø–∞–¥–∞–Ω–∏–µ!", f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {message}"
    print(f"‚úì –ü–æ–ø–∞–¥–∞–Ω–∏–µ: {message}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª –≤ —Ç—É –∂–µ –∫–ª–µ—Ç–∫—É
    hit, message = board.shoot(0, 0)
    assert hit == False and "—É–∂–µ —Å—Ç—Ä–µ–ª—è–ª–∏" in message, f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {message}"
    print(f"‚úì –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª: {message}")
    
    # –î–æ–±–∏–≤–∞–µ–º –∫–æ—Ä–∞–±–ª—å
    board.shoot(1, 0)
    hit, message = board.shoot(2, 0)
    assert hit == True and "–ø–æ—Ç–æ–ø–ª–µ–Ω" in message, f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {message}"
    print(f"‚úì –ü–æ—Ç–æ–ø–ª–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è: {message}")
    
    print("\n‚úÖ –¢–µ—Å—Ç –≤—ã—Å—Ç—Ä–µ–ª–æ–≤ –ø—Ä–æ–π–¥–µ–Ω!\n")


def test_game_parsing():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç"""
    print("=" * 50)
    print("–¢–ï–°–¢ 5: –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç")
    print("=" * 50)
    
    game = Game()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    coords = game.parse_coordinates("A1")
    assert coords == (0, 0), f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥: {coords}"
    print(f"‚úì A1 ‚Üí {coords}")
    
    coords = game.parse_coordinates("F6")
    assert coords == (5, 5), f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥: {coords}"
    print(f"‚úì F6 ‚Üí {coords}")
    
    coords = game.parse_coordinates("C3")
    assert coords == (2, 2), f"–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥: {coords}"
    print(f"‚úì C3 ‚Üí {coords}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    coords = game.parse_coordinates("G1")
    assert coords is None, f"–î–æ–ª–∂–µ–Ω –±—ã—Ç—å None –¥–ª—è G1: {coords}"
    print("‚úì G1 ‚Üí None (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –±—É–∫–≤–∞)")
    
    coords = game.parse_coordinates("A7")
    assert coords is None, f"–î–æ–ª–∂–µ–Ω –±—ã—Ç—å None –¥–ª—è A7: {coords}"
    print("‚úì A7 ‚Üí None (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–∏—Ñ—Ä–∞)")
    
    coords = game.parse_coordinates("ABC")
    assert coords is None, f"–î–æ–ª–∂–µ–Ω –±—ã—Ç—å None –¥–ª—è ABC: {coords}"
    print("‚úì ABC ‚Üí None (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–æ–≤)")
    
    print("\n‚úÖ –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø—Ä–æ–π–¥–µ–Ω!\n")


def test_board_display():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—è"""
    print("=" * 50)
    print("–¢–ï–°–¢ 6: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—è")
    print("=" * 50)
    
    board = Board()
    board.ships[0].place(0, 0, horizontal=True)
    
    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–ª–µ —Å–æ —Å–∫—Ä—ã—Ç—ã–º–∏ –∫–æ—Ä–∞–±–ª—è–º–∏
    display_hidden = board.display(hide_ships=True)
    assert "‚ñ†" not in display_hidden, "–ö–æ—Ä–∞–±–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∫—Ä—ã—Ç—ã"
    print("‚úì –ü–æ–ª–µ —Å–æ —Å–∫—Ä—ã—Ç—ã–º–∏ –∫–æ—Ä–∞–±–ª—è–º–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    
    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–ª–µ —Å –≤–∏–¥–∏–º—ã–º–∏ –∫–æ—Ä–∞–±–ª—è–º–∏
    display_visible = board.display(hide_ships=False)
    assert "‚ñ†" in display_visible, "–ö–æ—Ä–∞–±–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã"
    print("‚úì –ü–æ–ª–µ —Å –≤–∏–¥–∏–º—ã–º–∏ –∫–æ—Ä–∞–±–ª—è–º–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    
    # –î–µ–ª–∞–µ–º –≤—ã—Å—Ç—Ä–µ–ª –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    board.shoot(0, 0)
    display_after_shot = board.display(hide_ships=False)
    assert "X" in display_after_shot, "–ü–æ–ø–∞–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–º–µ—á–µ–Ω–æ"
    print("‚úì –ü–æ–ø–∞–¥–∞–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    
    print("\n‚úÖ –¢–µ—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–π–¥–µ–Ω!\n")


def run_all_tests():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã"""
    print("\n")
    print("‚ïî" + "=" * 48 + "‚ïó")
    print("‚ïë" + " " * 10 + "–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò–ì–†–´ '–ú–û–†–°–ö–û–ô –ë–û–ô'" + " " * 6 + "‚ïë")
    print("‚ïö" + "=" * 48 + "‚ïù")
    print()
    
    try:
        test_ship()
        test_board()
        test_board_auto_placement()
        test_shooting()
        test_game_parsing()
        test_board_display()
        
        print("=" * 50)
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û! üéâ")
        print("=" * 50)
        print("\n–ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É!")
        print("–ó–∞–ø—É—Å—Ç–∏—Ç–µ: python battleship.py")
        print()
        
        return True
    
    except AssertionError as e:
        print(f"\n‚ùå –û–®–ò–ë–ö–ê –¢–ï–°–¢–ê: {e}")
        return False
    except Exception as e:
        print(f"\n‚ùå –ù–ï–û–ñ–ò–î–ê–ù–ù–ê–Ø –û–®–ò–ë–ö–ê: {e}")
        import traceback
        traceback.print_exc()
        return False


if __name__ == "__main__":
    success = run_all_tests()
    sys.exit(0 if success else 1)

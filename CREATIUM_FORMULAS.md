# Формулы Creatium

Язык формул Creatium спроектирован таким образом, чтобы его можно было быстро освоить и начать использовать за максимально короткий период времени, при этом он дает большие возможности для работы с данными, которые никак иначе не доступны.

## Типы данных

### Числа (number)

- **Целые числа**: `123`, `-34`, `0` и т.д.
- **Дробные числа**: `10.22`, `0.01` и т.д.
- **Научная нотация**: `1.602176565e-19`, `6.02214129e+23` и т.д.
- **Особые значения**: `Infinity` (бесконечность) и `NaN` ("Not a Number")

### Строки (string)

- Заключаются в одинарные (`'`) или двойные (`"`) кавычки
- Типографские кавычки (вроде `'`, `'`, `‟`, `"`) не принимаются
- Примеры: `"Hello!"`, `"123"`, `'Test'`
- Экранирование: `"Это просто \"чудо\" какое-то"` или `'Это просто "чудо" какое-то'`

### Истина или ложь (boolean)

- Только два значения: `true` или `false`
- `true` означает положительное значение (да, включено, в наличии)
- `false` означает отрицательное значение (нет, выключено, отсутствует)

### Массивы (array)

- Набор значений, разделенных запятыми, заключенный в квадратные скобки
- Примеры: `[1, 2, 3]`, `["a", "b", "c"]`
- Могут содержать значения разных типов: `[1, "b", false]`
- Поддерживают вложенные массивы: `[1, [12, 13], ["a", "b"]]`

### Объекты (object)

- Набор пар ключ-значение, разделенных запятыми, заключенный в фигурные скобки
- Ключ может быть только строкой, значение — любого типа
- Между ключом и значением ставится двоеточие: `{"x": 12, "y": 44}`
- Если ключ содержит только латинские буквы, цифры (не в начале) и `_`, кавычки не нужны: `{name: "John", age: 34}`
- Поддерживают вложенные объекты
- Повторяющиеся ключи: последнее значение считается верным

### Даты (date)

- Записываются между двумя знаками `#` в формате "год-месяц-день"
- Примеры: `#2022-04-22#`, `#1994-05-04#`
- Ведущий ноль обязателен: `#1994-05-04#` (не `#1994-5-4#`)
- С временем: `#2022-04-22 14:05#`
- С секундами: `#2022-04-22 14:05:15#`
- С миллисекундами: `#2022-04-22 14:05:15.245#`
- С часовым поясом: `#2022-04-22 14:30 +05#` (Нью-Йорк), `#2022-04-22 14:30 -03#` (Москва)
- По умолчанию используется время по Гринвичу (UTC)

### Тип null

- Означает отсутствующее значение
- Единственное возможное значение: `null`

## Переменные

- Обеспечивают доступ к значениям, которые могут меняться
- Могут содержать значение любого типа
- Название может содержать латинские буквы, цифры и `_`, но не может начинаться с цифры
- Примеры названий: `member_id`, `url`, `test123`

### Синтаксис объявления переменных

```
название_переменной = формула;
название_переменной2 = формула;
...
формула
```

### Доступ к элементам массива

- Синтаксис: `array[0]`, где `0` — номер элемента
- Нумерация начинается с 0 (первый элемент — `0`, второй — `1`)
- Пример: `prices = [25, 33, 11]; prices[1]` вернет `33`
- Отрицательные индексы для доступа с конца: `prices[-1]` вернет последний элемент

### Доступ к значениям объекта

- Синтаксис: `object["ключ"]`
- Пример: `man = {"first name": "John", "age": 34}; man["first name"]` вернет `"John"`
- Упрощенный синтаксис для простых ключей: `man.age` вместо `man["age"]`

## Комментарии

### Многострочные комментарии

- Синтаксис: `/* комментарий */`
- Может быть многострочным или занимать часть строки
- Пример: `myDate + /* сутки */ 86400000`

### Однострочные комментарии

- Синтаксис: `// комментарий`
- Превращает в комментарий всю оставшуюся часть строки
- Удобно использовать при перечислении элементов массива или значений объектов
- Пример:
```
sum([
	10,
	20,
	// 30,
	40,
])
```

## Операторы

- **Сложение и вычитание**: `+`, `-`
- **Умножение и деление**: `*`, `/`
- **Остаток от деления**: `%`
- **Объединение строк**: `&`
- **Операторы сравнения**: `==`, `!=`, `>`, `>=`, `<`, `<=`
- **Логический оператор**: `and`
- **Логический оператор**: `or`
- **Значение по умолчанию**: `??`
- **Значение или null**: `?`
- **Наличие элемента в массиве**: `in`

## Функции

### Способы вызова функций

1. Передать значение в качестве первого аргумента: `locate('Hello, world!', 'Hello')`
2. Выполнить функцию над значением через точку: `'Hello, world!'.locate('Hello')`

Оба способа эквивалентны.

### Математические функции

- `sum(numbers)` — складывает все числа в массиве
- `multiply(numbers)` — умножает между собой все числа в массиве
- `abs(number)` — возвращает абсолютное значение числа
- `round(number, precision?)` — округляет число с заданной точностью
- `trunc(number, precision?)` — отсекает дробную часть с заданной точностью
- `floor(number)` — округляет число вниз
- `ceil(number)` — округляет число вверх
- `random()` — генератор случайных чисел
- `min(numbers)` — возвращает минимальное значение из списка
- `max(numbers)` — возвращает максимальное значение из списка
- `pow(number, exponent)` — возводит число в указанную степень
- `sqrt(number)` — возвращает квадратный корень числа
- `log(number, base)` — возвращает логарифм числа
- `exp(number)` — возвращает значение выражения «E в степени number»
- **Тригонометрия**: `acos`, `acosh`, `asin`, `asinh`, `atan2`, `atan`, `atanh`, `cos`, `cosh`, `sin`, `sinh`, `tan`, `tanh`

### Работа с текстом

- `length(string)` — возвращает количество символов
- `locate(string, substring, start?)` — возвращает позицию первого вхождения подстроки
- `substr(string, start, count?)` — возвращает подстроку
- `join(strings, separator?)` — объединяет все элементы массива в одну строку
- `trim(string)` — удаляет пробельные символы с начала и конца строки
- `trimStart(string)` — удаляет пробельные символы с начала
- `trimEnd(string)` — удаляет пробельные символы с конца строки
- `split(string, separator)` — разделяет строку на подстроки с помощью разделителя
- `replace(string, find, replacement)` — осуществляет замену первой найденной подстроки на заданную
- `replaceAll(string, find, replacement)` — осуществляет замену всех найденных подстрок на заданную
- `lower(string)` — преобразовывает строку в строчные буквы (нижний регистр)
- `upper(string)` — преобразовывает строку в заглавные буквы (верхний регистр)

### Массивы (списки)

- `count(array)` — возвращает количество элементов в массиве
- `range(start, end, step?)` — генерирует массив из чисел заданной длины
- `map(array, expression)` — выполняет преобразование каждого элемента массива
- `merge(array1, array2, …)` — объединяет несколько массивов в один
- `reduce(array, expression, initialValue)` — выполняет преобразование каждого элемента массива, возвращая одно результирующее значение
- `reverse(array)` — возвращает массив с элементами, переставленными в обратном порядке
- `filter(array, expression)` — удаляет элементы массива, не соответствующие условию
- `sort(array, expression?)` — сортирует элементы массива в порядке возрастания
- `slice(array, start, count?)` — обрезает массив, возвращая часть исходного
- `unique(array)` — оставляет только уникальные значения массива
- `indexOf(array, expression)` — возвращает номер элемента в массиве

### Объекты

- `arrayToObject(array)` — преобразует массив в объект
- `objectToArray(object)` — преобразует объект в массив

### Дата и время

- `now()` — текущая дата и время
- `dateAdd(date, unit, amount)` — прибавляет к дате указанное количество единиц
- `dateSubtract(date, unit, amount)` — вычитает из даты указанное количество единиц
- `toDate(value)` — преобразует значение в дату

### Логические функции

- `if(condition, then, else)` — условный оператор
- `not(value)` — возвращает `true` вместо `false` и наоборот
- `let(variables, expression)` — присваивает имена результатам вычислений

### Типы данных

- `type(value)` — возвращает тип значения: `number`, `string`, `boolean`, `array`, `object`, `date` или `null`
- `toBoolean(value)` — преобразует значение в тип `boolean` (`true` или `false`)
- `toNumber(value)` — преобразует значение в число
- `toString(value)` — преобразует значение в строку
- `toDate(value)` — преобразует значение в дату
- `exists(value)` — проверяет существование значения
